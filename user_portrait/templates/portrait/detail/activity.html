<link href="/static/personal/css/activity.css" rel="stylesheet" type="text/css" />
<div id="Activezh" style="height:300px;width:750px"></div>
<div id ="Plocation">
	<div class="LocationTitle fleft" style="width:100%">位置分布TOP5</div>
	<div class="LocationDetail" id="Top5">
		<dl>
			<dt><span class="LocationImg mleft fleft"></span><span class="Acity fleft" id="top1">北京</span></dt>
		</dl>
		<dl>
			<dt><span class="LocationImg fleft mleft"></span><span class="Acity fleft" id="top2">上海</span></dt>
		</dl>
		<dl>
			<dt><span class="LocationImg fleft mleft"></span><span class="Acity fleft" id="top3">广州</span></dt>
		</dl>
		<dl>
			<dt><span class="LocationImg fleft mleft"></span><span class="Acity fleft" id="top4">深圳</span></dt>
		</dl>
		<dl>
			<dt><span class="LocationImg fleft mleft"></span><span class="Acity fleft" id="top5">杭州</span></dt>
		</dl>
	</div>
</div>




<div id="trend" style="height:50px;width:950px">
该用户的活跃时间段为：<span id="time1">08:00-12:00</span>和<span id="time2">08:00-12:00</span>
</div>
<div id="trend" style="height:50px;width:950px">
<span id="location_description">08:00-12:00</span>
</div>
<script src="/static/js/highstock.js" charset="utf-8"></script>
<script src="/static/js/exporting.js" charset="utf-8"></script>
<script src="/static/js/portrait/location.js" charset="utf-8"></script>
<script type="text/javascript">
// Date format
Date.prototype.format = function(format) {
    var o = {
        "M+" : this.getMonth()+1, //month
        "d+" : this.getDate(), //day
        "h+" : this.getHours(), //hour
        "m+" : this.getMinutes(), //minute
        "s+" : this.getSeconds(), //second
        "q+" : Math.floor((this.getMonth()+3)/3), //quarter
        "S" : this.getMilliseconds() //millisecond
    }
    if(/(y+)/.test(format)){
        format=format.replace(RegExp.$1, (this.getFullYear()+"").substr(4 - RegExp.$1.length));
    }
    for(var k in o){
        if(new RegExp("("+ k +")").test(format)){
            format = format.replace(RegExp.$1, RegExp.$1.length==1 ? o[k] : ("00"+ o[k]).substr((""+ o[k]).length));
        }
    }
    return format;
}

 function Activity(){
  this.ajax_method = 'GET';
}
Activity.prototype = {   //获取数据，重新画表
  call_sync_ajax_request:function(url, method, callback){
    $.ajax({
      url: url,
      type: method,
      dataType: 'json',
      async: false,
      success:callback
    });
  },

  active:function(data){
	var item = data.activity_time;
        for (i=0;i<item.length;i++){
           var date = item[i][0]/(15*60*16);
           switch(date)
		   {
				case 1: x = "00:00-04:00";break;
				case 2: x = "04:00-08:00";break;
				case 3: x = "08:00-12:00";break;
				case 4: x = "12:00-16:00";break;
				case 5: x = "16:00-20:00";break;
				case 6: x = "20:00-24:00";break;
		   }
		   var str ="time"+(i+1);
		   time = document.getElementById(str);
		   time.innerHTML = x;
        }
    var trend = data.activity_trend;
	var data_count=[];
	var data_time = [];
    for(i=0;i<trend.length;i++){
        var time = getDate(trend[i][0]);
        var count = trend[i][1];
		data_time.push(time);
		data_count.push(count);
    }
	//Draw_trend:
	 $('#Activezh').highcharts({
        chart: {
            type: 'spline',// line,
            animation: Highcharts.svg, // don't animate in old IE
            style: {
                fontSize: '12px',
                fontFamily: 'Microsoft YaHei'
            }},
        title: {
            text: '微博时间走势图',
            x: -20 //center
        },
        subtitle: {
            text: '',
            x: -20
        },
    lang: {
            printChart: "打印",
            downloadJPEG: "下载JPEG 图片",
            downloadPDF: "下载PDF文档",
            downloadPNG: "下载PNG 图片",
            downloadSVG: "下载SVG 矢量图",
            exportButtonTitle: "导出图片"
        },
        xAxis: {
            categories: data_time,
            labels:{
              rotation: -45,
              step: 6
            }
        },
        yAxis: {
            title: {
                text: '微博总量 (条)'
            },
            plotLines: [{
                value: 0,
                width: 1,
                color: '#808080'
            }]
        },
        tooltip: {
            valueSuffix: '条',
            xDateFormat: '%Y-%m-%d %H:%M:%S'
        },
        legend: {
            layout: 'vertical',
            align: 'right',
            verticalAlign: 'middle',
            borderWidth: 0
        },
        series: [{
            name:'微博量',
            data: data_count
        }]
    });
  }
}
function getDate(tm){
    var tt = new Date(parseInt(tm)*1000).format("yyyy年MM月dd日 hh:mm:ss");
    return tt;
}
var Activity = new Activity();
url = '/attribute/activity/?uid=1642591402' 
Activity.call_sync_ajax_request(url, Activity.ajax_method, Activity.active);
var location_geo = parent.personalData.activity_geo;
//console.log(location_geo);
$('#Top5').empty();
var html = '';
for (i=1;i<location_geo.length+1;i++){
	//console.log(location_geo[i][0]); 
	html += '<dl><dt><span class="LocationImg  fleft"></span><span class="Acity fleft" id="top1">'+location_geo[i-1][0]+'</span></dt></dl>'
}
$('#Top5').append(html);
</script>
