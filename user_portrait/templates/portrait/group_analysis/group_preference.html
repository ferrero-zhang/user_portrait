<link href="/static/personal/css/language.css" rel="stylesheet" type="text/css" />
<link href="/static/personal/css/default.css" rel="stylesheet" type="text/css" />
<link href="/static/personal/css/component.css" rel="stylesheet" type="text/css" />
<script src="/static/js/modernizr.custom.js"></script>

<div class="col-lg-6">
    <div class="panel panel-default">
        <div class="panel-heading" style="border-bottom: 1px solid transparent;border-color: #dddddd;">
            <div><span class="showmore" id="showmore_keyWords" style="float:right;cursor:pointer" type="button"data-toggle="modal" data-target="#more_keyWords" ><u>查看详情</u></span>关键词</div>
        </div>
        <div class="panel-body">
          <div id="Language" style="width:300px;height:280px;margin:30px 40px;margin:-10px 50px 0px 20px;">
          </div>
      </div>
  </div>
</div>

<div class="col-lg-6">
    <div class="panel panel-default">
        <div class="panel-heading" style="border-bottom: 1px solid transparent;border-color: #dddddd;">
            <div><span class="showmore" id="showmore_hashtagWords" style="float:right;cursor:pointer" type="button"data-toggle="modal" data-target="#more_hashtagWords" ><u>查看详情</u></span>事件标签</div>
        </div>
        <div class="panel-body">
          <div id="hashtag_words" style="width:300px;height:280px;margin:30px 40px;margin:-10px 50px 0px 20px;">
          </div>
      </div>
  </div>
</div>

<div class="col-lg-6" style="margin-top:15px;">
    <div class="panel panel-default">
        <div class="panel-heading" style="border-bottom: 1px solid transparent;border-color: #dddddd;">
            <div><span class="showmore" id="showmore_domain" style="float:right;cursor:pointer" type="button"data-toggle="modal" data-target="#more_domain" ><u>查看详情</u></span>用户领域分布</div>
        </div>
        <div class="panel-body">
          <div id="preference_domain"  style="width:450px;height:300px;margin-left: -30px;">
          </div>
      </div>
  </div>
</div>

<div class="col-lg-6" style="margin-top:15px;">
    <div class="panel panel-default">
        <div class="panel-heading" style="border-bottom: 1px solid transparent;border-color: #dddddd;">
            <div><span class="showmore" id="showmore_topic" style="float:right;cursor:pointer" type="button"data-toggle="modal" data-target="#more_topic" ><u>查看详情</u></span>用户话题分布</div>
        </div>
        <div class="panel-body">
          <div id="preference_topic"  style="width:450px;height:300px;margin-left: -30px;">
          </div>
      </div>
  </div>
</div>
  
<div id="preference_conclusion" style="width:100%;"></div>

<!-- 模态框 -->
<div class="modal fade" id="more_keyWords" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content" style="width: 500px;">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" style="font-size:18px" id="myModalLabel">关键词排名</h4>
      </div>
      <div class="modal-body" id='key_WordList'>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="more_hashtagWords" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content"  style="width: 500px;">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" style="font-size:18px" id="myModalLabel">事件标签排名</h4>
      </div>
      <div class="modal-body" id='hashtag_WordList'>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="more_domain" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content" style="width:500px;">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" style="font-size:18px" id="myModalLabel">用户领域分布</h4>
      </div>
      <div class="modal-body" id='domain_WordList'>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="more_topic" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content"  style="width: 500px;">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" style="font-size:18px" id="myModalLabel">用户话题分布</h4>
      </div>
      <div class="modal-body" id='topic_WordList'>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
function Show_pref(url,div){
    that = this;
    this.ajax_method = 'GET';
    this.div = div;
}
Show_pref.prototype = {
  call_sync_ajax_request:function(url, method, callback){
    $.ajax({
      url: url,
      type: method,
      dataType: 'json',
      async: false,
      success:callback
    });
  },
  Draw_table:function(data){
    console.log(data);
    var keywords_data = data['keywords'];
    var keywords_name = 'Language';
    var keywords_more = 'key_WordList';
    var hashtag_data = data['hashtag'];
    var hashtag_name = 'hashtag_words';
    var hashtag_more = 'hashtag_WordList';
    var topic_data = data['topic'];
    var domain_data = data['domain'];
    Draw_keyword(keywords_data, keywords_name, keywords_more, showmore_keyWords);
    Draw_keyword(hashtag_data, hashtag_name, hashtag_more, showmore_hashtagWords);
    Draw_topic(topic_data,'preference_topic', 'topic_WordList');
    Draw_topic(domain_data,'preference_domain', 'domain_WordList');
  }
}

function show_conclusion(data){
  var html = '';
  html += '<span class="fleft" style="margin-right:10px;width:32px;height:32px;background-image:url(/static/img/warning.png);margin-top:5px;display:black;"></span>';
  //html += '<h4>'+data[0]+'<span style="color:red;">'+data[1]+'</span>，'+data[2]+'<span style="color:red;">'+data[3]+'</span>。</h4>';
  html += data;
  $("#preference_conclusion").append(html);
}

function createRandomItemStyle() {
    return {
        normal: {
            color: 'rgb(' + [
                Math.round(Math.random() * 160),
                Math.round(Math.random() * 160),
                Math.round(Math.random() * 160)
            ].join(',') + ')'
        }
    };
}
function Draw_keyword(data, div_name, more_div, hide_more){
  var keyword = [];
  var html = '';
  $('#'+ more_div).empty();
  if(data.length == 0){
     //console.log(div_name);
      html = '<h4 style="text-align:center;margin-top:50%;">暂无数据</h4>';
      //$('#'+ more_div).append(html);
      $('#'+ div_name).append(html);
      $('#'+ hide_more).empty();
  }else{
   
      html = '';
      html += '<table class="table table-striped table-bordered" style="width:450px;">';
      html += '<tr><th style="text-align:center">排名</th><th style="text-align:center">关键词</th><th style="text-align:center">频数</th></tr>';
      for (var i = 0; i < data.length; i++) {
         var s = i.toString();
         var m = i + 1;
         html += '<tr style=""><th style="text-align:center">' + m + '</th><th style="text-align:center"><a href="/index/search_result/?stype=2&uid=&uname=&location=&hashtag=&adkeyword=' + data[i][0] +  '&psycho_status=&domain&topic" target="_blank">' + data[i][0] +  '</a></th><th style="text-align:center">' + data[i][1] + '</th></tr>';
      };
      html += '</table>'; 
      $('#'+ more_div).append(html);

      var word_num = Math.min(20, data.length);

    for (i=0;i<word_num;i++){
      var word = {};
      word['name'] = data[i][0];
      word['value'] =data[i][1]*100;
      word['itemStyle'] = createRandomItemStyle();
      keyword.push(word);
    }

    var myChart = echarts.init(document.getElementById(div_name)); 
    var option = {
      tooltip: {
          show: true
      },
      series: [{
          type: 'wordCloud',
          size: ['130%', '130%'],
          textRotation : [0, 45, 90, -45],
          textPadding: 0,
          autoSize: {
              enable: true,
              minSize: 14
          },
          data: keyword
      }]
    };
        myChart.setOption(option);  
  }
}

function get_radar_data (data) {
  var topic = data;
  var topic_name = [];
  var topic_value = [];
  for(var i=0; i<topic.length;i++){
    topic_value.push(topic[i][1])
    topic_name.push(topic[i][0])
  };
  // var topic_value2 = [];
  // var topic_name2 = [];
  // for(var i=0; i<8;i++){ //取前8个最大值
  //   a=topic_value.indexOf(Math.max.apply(Math, topic_value));
  //   topic_value2.push(topic_value[a].toFixed(3));
  //   topic_name2.push(topic_name[a]);
  //   topic_value[a]=0;
  // }
  var topic_name3 = [];
  for(var i=0;i<8;i++){ //设置最大值的话题的阈值
    var name_dict = {};
    var index = topic_name[i];
    name_dict["text"] = index;
    name_dict["max"] = Math.max.apply(Math, topic_value).toFixed(3)+0.2;
    topic_name3.push(name_dict);
  }
  var topic_result = [];
  topic_result.push(topic_name3);
  topic_result.push(topic_value);
  return topic_result;
}
function Draw_topic(data, radar_div, motal_div){
  console.log(data);
  var topic = [];
  var html = '';
  $('#'+ motal_div).empty();
  if(data.length == 0){
      $('#'+ motal_div).empty();
      html = '<h3 style="font-size:20px;text-align:center;margin-top:50%;">暂无数据</h3>';
      //$('#'+ more_div).append(html);
      $('#'+ radar_div).append(html);
      $('#'+ motal_div).append(html);
      //$('#'+ show_more).empty();
  }else{
      html = '';
      html += '<table class="table table-striped table-bordered" style="width:450px;">';
      html += '<tr><th style="text-align:center">排名</th><th style="text-align:center">关键词</th><th style="text-align:center">频率</th></tr>';
      for (var i = 0; i < data.length; i++) {
         var s = i.toString();
         var m = i + 1;
         html += '<tr style=""><th style="text-align:center">' + m + '</th><th style="text-align:center"><a href="/index/search_result/?stype=2&uid=&uname=&location=&hashtag=&adkeyword=' + data[i][0] +  '&psycho_status=&domain&topic" target="_blank">' + data[i][0] +  '</a></th><th style="text-align:center">' + data[i][1].toFixed(2) + '</th></tr>';
      };
      html += '</table>'; 
      $('#'+ motal_div).append(html);
    };
  var topic_result = [];
  topic_result = get_radar_data(data);
  var topic_name = topic_result[0];
  var topic_value = topic_result[1];
  var myChart2 = echarts.init(document.getElementById(radar_div));
  var option = {
    // title : {
    //   text: '用户话题分布',
    //   subtext: ''
    // },
      tooltip : {
        trigger: 'axis'
      },
      toolbox: {
        show : true,
        feature : {
            mark : {show: true},
            dataView : {show: true, readOnly: false},
            restore : {show: true},
            saveAsImage : {show: true}
        }
      },
      calculable : true,
      polar : [
       {
        indicator :topic_name,
        radius : 90
       }
      ],
      series : [
       {
        name: '话题分布情况',
        type: 'radar',
        itemStyle: {
         normal: {
          areaStyle: {
            type: 'default'
          }
         }
        },
       data : [
        {
         value : topic_value,
         name : '用户话题分布'}
       ]
      }]
  };
  myChart2.setOption(option);
}

function show_domain(data){

  // var html = '';
  //html += '<h3>用户领域分析</h3>';
  data1 = '根据注册信息分类：'+data[0][0];
  data2 = '根据转发结构分类：'+data[0][1];
  data3 = '根据发帖内容分类：'+data[0][2];
  data4 = data[1];
  var myChart1 = echarts.init(document.getElementById('preference_domain')); 
  var option = {
    tooltip : {
        trigger: 'item',
        formatter: "{b}"
    },
    toolbox: {
        show : true,
        feature : {
            mark : {show: true},
            dataView : {show: true, readOnly: false},
            restore : {show: true},
            saveAsImage : {show: true}
        }
    },
    calculable : false,

    series : [
        {
            name:'树图',
            type:'tree',
            orient: 'horizontal',  // vertical horizontal
            rootLocation: {x: 30, y: 'center'}, // 根节点位置  {x: 'center',y: 10}
            nodePadding: 50,
            symbol: 'circle',
            symbolSize: 60,
            itemStyle: {
                normal: {
                    label: {
                        show: false,
                        position: 'inside',
                        textStyle: {
                            color: '#000',
                            fontSize: 14,
                            font_family: "Microsoft YaHei UI"
                        }
                    },
                    lineStyle: {
                        color: '#000',
                        width: 1,
                        type: 'curve' // 'curve'|'broken'|'solid'|'dotted'|'dashed'
                    }
                },
                emphasis: {
                    label: {
                        show: false,
                        fontSize: 14,
                    }
                }
            },
            data: [
                {
                    name: data4,
                    //value: 2,
                    // symbolSize: [90, 70],
                    // symbol: 'image://http://www.iconpng.com/png/ecommerce-business/iphone.png',
                    itemStyle: {
                        normal: {
                           color: '#95C6E2',
                            label: {
                                show: true
                            }
                        }
                    },
                    children: [
                        {
                          name: data1,
                          symbol: 'circle',
                          symbolSize: 20,
                          value: 4,
                          itemStyle: {
                              normal: {
                                  color: '#77B1E2',
                                  label: {
                                      show: true,
                                      position: 'right'
                                  },
                                  
                              },
                              emphasis: {
                                  label: {
                                      show: false
                                  },
                                  borderWidth: 0
                              }
                          }
                        },
                        {
                          name: data2,
                          symbol: 'circle',
                          symbolSize: 20,
                          value: 4,
                          itemStyle: {
                              normal: {
                                  color: '#367FBD',
                                  label: {
                                      show: true,
                                      position: 'right'
                                  },
                                  
                              },
                              emphasis: {
                                  label: {
                                      show: false
                                  },
                                  borderWidth: 0
                              }
                          }
                        },
                        {
                          name: data3,
                          symbol: 'circle',
                          symbolSize: 20,
                          value: 4,
                          itemStyle: {
                              normal: {
                                  color: '#31708F',
                                  label: {
                                      show: true,
                                      position: 'right'
                                  },
                                  
                              },
                              emphasis: {
                                  label: {
                                      show: false
                                  },
                                  borderWidth: 0
                              }
                          }
                        }    
                    ]
                }
            ]
        }
    ]
  };
   myChart1.setOption(option);               
}

function show_results(data){
  console.log(data);
//  var keywordsCloud = data.results.keywords;
  
  //console.log(keywordsCloud);
//  var hashtag = data.results.hashtag;
//var hashtag = ['000','111','222','333','444','555','666'];
//var topic = [['sdgsd',21],['dsf',23],['sfv',12],['rhtb',13],['6ef',28],['sgsd',51],['d2sf',17],['tfv',22],['htb',1]];
//var domain = [];

//  var conclusion = data.description;
//var conclusion = 'conclusion///';
//  var domain = data.results.domain;
//  var keywords_name = 'Language';
  //var hashtag_name = 'hashtag_words';
 // var keywords_more = 'key_WordList';
  
//var key_more = 'key_more';
//var hash_more = 'hash_more';
 
  //Draw_keyword(keywordsCloud, keywords_name, keywords_more, showmore_keyWords);
  //Draw_keyword(hashtag, hashtag_name, hashtag_more, showmore_hashtagWords);
  //Draw_topic(topic,'preference_topic', 'topic_WordList','showmore_topic');
  //Draw_topic(topic,'preference_domain', 'domain_WordList','showmore_domain');
  show_conclusion(conclusion);
//  show_domain(domain);


  // var tag_vector = data.tag_vector;
  // //console.log(tag_vector);
  // for(var i=0; i<tag_vector.length;i++){
  //   if(tag_vector[i][1] == ''){
  //     tag_vector[i][1] = '暂无数据'
  //   }
  //   global_tag_vector.push(tag_vector[i]);
  // }

  }

var Show_pref = new Show_pref();
//var url = http://219.224.135.93:9040/index/personal/?uid=2074370833
var prefrence_url = '/group/show_group_result/?task_name=媒体&module=preference';
Show_pref.call_sync_ajax_request(prefrence_url, Show_pref.ajax_method, Show_pref.Draw_table);
  </script>
