 {% extends "tbase.html" %}
{% block main %}
<script type="text/javascript" src='/static/js/esl.js'></script>
<script type="text/javascript" src='/static/js/echarts-all.js'></script>
<script type="text/javascript" src='/static/js/echarts.js'></script>
<style>
    .cate_title {
        background: #fafafa;
        cursor: pointer;
    }
    td:hover {
        background: #f2f9ff;
    }
    .center {
        text-align: center;
    }
</style>
<div class="row">
    <div class="box col-md-12" style='width:120%'>
        <div class="box-inner">
            <div class="box-content">
                <table class="table table-bordered responsive" id='table_compare' style="table-layout:fixed;">
                    
                </table>
            </div>
        </div>
    </div>
    <!--/span-->

</div><!--/row-->
<script>

function Search_weibo(){
  this.ajax_method = 'GET';
  that = this;
}

Search_weibo.prototype = {

    call_sync_ajax_request:function(url, method, callback){
        $.ajax({
          url: url,
          type: method,
          dataType: 'json',
          async: false,
          success:callback
        });
    },

    Get_Callback_data:function(data){
        that.call_data = data
    },
    
    Return_data: function(){
        return that.call_data;
    },

    Draw_table: function(data){
        $('#table').empty();
        var html = '';
        html += '<table class="table table-striped table-bordered bootstrap-datatable datatype responsive" >';
        html += '<thead><tr><th class="center" style="text-align:center">用户id</th><th class="center" style="text-align:center">昵称</th><th class="center" style="text-align:center">重要度</th><th class="center" style="text-align:center;width:72px">活跃度</th><th class="center" style="text-align:center">影响力</th><th class="center" style="text-align:center">得分</th></tr></thead>';
        html += '<tbody>';
        for(var item in data){
            html += '<tr>';
            for(var i =0; i < data[item].length; i++){                
                html += '<td class="center" style="text-align:center;vertical-align:middle">'+ data[item][i] +'</td>';
            }
            html += '</tr>';
        }
        html += '</tbody>';
        html += '</table>';
        $('#table').append(html);
    },

    Draw_cloud_keywords:function(data, div){

        function createRandomItemStyle() {
            return {
                normal: {
                    color: 'rgb(' + [
                        Math.round(Math.random() * 160),
                        Math.round(Math.random() * 160),
                        Math.round(Math.random() * 160)
                    ].join(',') + ')'
                }
            };
        }
        console.log(div);
        var keywords_data = data['keywords'];
        var keywords = new Array();
        for(var key in keywords_data){
            keywords.push({'name':key, 'value':keywords_data[key]*1000, 'itemStyle':createRandomItemStyle()});
        }

        option = {
            title: {
                text: '',
            },
            tooltip: {
                show: true
            },
            series: [{
                name: '',
                type: 'wordCloud',
                size: ['80%', '80%'],
                textRotation : [0, 45, 90, -45],
                textPadding: 0,
                autoSize: {
                    enable: true,
                    minSize: 14
                },
                data: keywords,
            }]
        };
        var myChart = echarts.init(document.getElementById(div));
        myChart.setOption(option);
    },

    Draw_line:function(x_data, value_data,div){

        option = {
            title : {
                text: '',
                subtext: ''
            },
            tooltip : {
                trigger: 'axis'
            },
            calculable : true,
            xAxis : [
                {
                    type : 'category',
                    boundaryGap : false,
                    data : x_data
                }
            ],
            yAxis : [
                {
                    type : 'value',
                    axisLabel : {
                        formatter: ''
                    }
                }
            ],
            series : [
                {
                    name:'',
                    type:'line',
                    data: value_data,
                    smooth:true,
                    markPoint : {
                        data : [
                            {type : 'max', name: '最大值'},
                            {type : 'min', name: '最小值'}
                        ]
                    },
                    markLine : {
                        data : [
                            {type : 'average', name: '平均值'}
                        ]
                    }
                },
            ]
        };
        var myChart = echarts.init(document.getElementById(div));
        myChart.setOption(option);
                    
    },

    Draw_picture: function(data){
        var Related_Node = new Array();
        var Related_Link = new Array();
        var user_name = data[0][1];
        console.log(Related_Node);
        for(var item =0; item < data.length; item++){
            Related_Node.push({'name':data[item][1], 'value':data[item][5], 'label':data[item][1]});
            Related_Link.push({'source':user_name, 'target':data[item][1], 'weight':data[item][5]});
        }
        var option = {
                title : {
                    text: '',
                    subtext: '',
                    x:'right',
                    y:'bottom'
                },
                tooltip : {
                    trigger: 'item',
                    formatter: '{a} : {b}'
                },
                toolbox: {
                    show : true,
                    feature : {
                        restore : {show: true},
                        magicType: {show: true, type: ['force', 'chord']},
                        saveAsImage : {show: true}
                    }
                },
                legend: {
                    x: 'left',
                    data:['家人']
                },
                series : [
                    {
                        type:'force',
                        name : "人物关系",
                        ribbonType: false,
                        itemStyle: {
                            normal: {
                                label: {
                                    show: true,
                                    textStyle: {
                                        color: '#333'
                                    }
                                },
                                nodeStyle : {
                                    brushType : 'both',
                                    borderColor : 'rgba(255,215,0,0.4)',
                                    borderWidth : 1
                                },
                                linkStyle: {
                                    type: 'curve'
                                }
                            },
                            emphasis: {
                                label: {
                                    show: false
                                    // textStyle: null      // 默认使用全局文本样式，详见TEXTSTYLE
                                },
                                nodeStyle : {
                                    //r: 30
                                },
                                linkStyle : {}
                            }
                        },
                        useWorker: false,
                        minRadius : 15,
                        maxRadius : 25,
                        gravity: 1.1,
                        scaling: 1.1,
                        roam: 'move',
                        nodes: Related_Node,
                        links : Related_Link,
                    }
                ]
        };  

        var myChart = echarts.init(document.getElementById('echart'));
        myChart.setOption(option);
        //回调函数，添加监听事件
        require([
                'echarts'
            ],
            function(ec){
                var ecConfig = require('echarts/config');
                function focus(param) {
                    var data = param.data;
                    var links = option.series[0].links;
                    var nodes = option.series[0].nodes;
                    if (
                        data.source != null
                        && data.target != null
                    ) { //点击的是边
                        var sourceNode = nodes.filter(function (n) {return n.name == data.source})[0];
                        var targetNode = nodes.filter(function (n) {return n.name == data.target})[0];
                        // console.log("选中了边 " + sourceNode.name + ' -> ' + targetNode.name + ' (' + data.weight + ')');
                    } else { // 点击的是点
                    }
                }
                    myChart.on(ecConfig.EVENT.CLICK, focus)

                    myChart.on(ecConfig.EVENT.FORCE_LAYOUT_END, function () {
                        console.log(myChart.chart.force.getPosition());
                    });
                }
        )     
    },
}

Search_weibo = new Search_weibo();
var url_activity = '/manage/compare_user_activity/?uid_list=1642591402,2948738352';
var url_profile = '/manage/compare_user_profile/?uid_list=1642591402,2948738352';
var url_portrait = '/manage/compare_user_portrait/?uid_list=1642591402,2948738352';
Search_weibo.call_sync_ajax_request(url_profile, Search_weibo.ajax_method, Search_weibo.Get_Callback_data);
var url_photo = Search_weibo.Return_data();
Search_weibo.call_sync_ajax_request(url_activity, Search_weibo.ajax_method, Search_weibo.Get_Callback_data);
var activity = Search_weibo.Return_data();
Search_weibo.call_sync_ajax_request(url_portrait, Search_weibo.ajax_method, Search_weibo.Get_Callback_data);
var portrait = Search_weibo.Return_data();
console.log(portrait);
function Compare(){
    var html = '';
    var num = 0;
    var j = 0;
    for(var k in url_photo){
        num += 1;
    }
    html += '<thead>'
    html += '<tr style="background: #fafafa;"><th style="width:100px;font-size:20px;vertical-align:middle; text-align:center;"><b>用户图像</b></th>';
    var i =0;
    for(var k in url_photo){
        i += 1;
        html += '<th name="line'+ i +'">';
        html += '<div class="panel-heading text-center">';
        html += '<div class="col-md-9">';
        html += '<img src='+url_photo[k]+' alt="" class="img-circle">'
        html += '</div>';
        html += '<div class="col-md-3">';
        html += '<a href="#" name="line'+i+'" class="btn btn-round btn-default" style="border-radius:40px;font-size:12px;padding-top:4px"><i class="glyphicon glyphicon-remove"></i></a>';
        html += '</div>'
        html += '</div>';
        html += '</th>';
    }
    html += '</tr></thead><tbody>';
    html += '<tr><td colspan="'+ (num +1) +'" name="list-1" class="cate_title" style="font-size:20px"><b>基本信息</b></td></tr>';
    j = 0;
    html += '<tr class="list-1"><td class="cate_title" style="width:90px;text-align:right">昵称</td>';
    for(var k in portrait){
        j += 1;
        html += '<td class="center" name="line'+ j +'">'+ portrait[k]['uname'] +'</td>';
    }
    html += '</tr>';

    html += '<tr class="list-1"><td class="cate_title" style="width:90px;text-align:right">性别</td>';
    j = 0;
    for(var k in portrait){
        j += 1;
        html += '<td class="center" name="line'+ j +'">'+ portrait[k]['gender'] +'</td>';
    }
    html += '</tr>';
    j = 0;
    html += '<tr class="list-1"><td class="cate_title" style="width:90px;text-align:right">注册地</td>';
    for(var k in portrait){
        j += 1;
        html += '<td class="center" name="line'+ j +'">'+ portrait[k]['location'] +'</td>';
    }
    html += '</tr>';
    j = 0;
    html += '<tr><td colspan="'+ (num+1) +'" name="list-2" class="cate_title" style="font-size:20px"><b>个体属性</b></td></tr>';
    html += '<tr class="list-2"><td class="cate_title" style="width:90px;text-align:right">重要度</td>';
    for(var k in portrait){
        j += 1;
        html += '<td class="center" name="line'+ j +'">'+ portrait[k]['importance'] +'</td>';
    }
    html += '</tr>';
    j = 0;
    html += '<tr class="list-2"><td class="cate_title" style="width:90px;text-align:right">活跃度</td>';
    for(var k in portrait){
        j += 1;
        html += '<td class="center" name="line'+ j +'">'+ portrait[k]['activeness'] +'</td>';
    }
    html += '</tr>';
    j = 0;
    html += '<tr class="list-2"><td class="cate_title" style="width:90px;text-align:right">影响力</td>';
    for(var k in portrait){
        j += 1;
        html += '<td class="center" name="line'+ j +'">'+ portrait[k]['influence'] +'</td>';
    }
    html += '</tr>';
    j = 0;
    html += '<tr class="list-2"><td class="cate_title" style="width:90px;text-align:right">活跃时间</td>';
    for(var k in portrait){
        j += 1;
        html += '<td class="center" name="line'+ j +'"><div id="activity'+ j +'" style="height:300px"></div></td>';
    }
    html += '</tr>';
    j = 0;
    html += '<tr><td colspan="'+ (portrait.length+1) +'" name="list-3" class="cate_title" style="font-size:20px"><b>微博信息</b></td></tr>';
    html += '<tr class="list-3"><td class="cate_title" style="width:90px;text-align:right">好友数</td>';
    for(var k in portrait){
        j += 1;
        html += '<td class="center" name="line'+ j +'">'+ portrait[k]['friendsnum'] +'</td>';
    }
    html += '</tr>';
    j = 0;
    html += '<tr class="list-3"><td class="cate_title" style="width:90px;text-align:right">微博数</td>';
    for(var k in portrait){
        j += 1;
        html += '<td class="center" name="line'+ j +'">'+ portrait[k]['statusnum'] +'</td>';
    }
    html += '</tr>';
    j = 0;
    html += '<tr class="list-3"><td class="cate_title" style="width:90px;text-align:right">粉丝数</td>';
    for(var k in portrait){
        j += 1;
        html += '<td class="center" name="line'+ j +'">'+ portrait[k]['fansnum'] +'</td>';
    }
    html += '</tr>';
    j = 0;
    html += '<tr><td colspan="'+ (num+1) +'" name="list-4" class="cate_title" style="font-size:20px"><b>行业信息</b></td></tr>';
    html += '<tr class="list-4"><td class="cate_title" style="width:90px;text-align:right">领域</td>';
    for(var k in portrait){
        j += 1;
        html += '<td class="center" name="line'+ j +'">'+ portrait[k]['domain'] +'</td>';
    }
    html += '</tr>';
    j = 0;
    html += '<tr class="list-4"><td class="cate_title" style="width:90px;text-align:right">话题</td>';
    for(var k in portrait){
        j += 1;
        html += '<td class="center" name="line'+ j +'">'+ portrait[k]['uname'] +'</td>';
    }
    html += '</tr>';
    j = 0;
    html += '<tr class="list-4"><td class="cate_title" style="width:90px;text-align:right">关键词</td>';
    for(var k in portrait){
        j += 1;
        html += '<td class="center" name="line'+ j +'"><div id="line'+ j +'" style="height:300px"></div></td>';
        var div = 'line'+ j;
    }
    html += '</tr>';
    j = 0;
    html += '<tr><td colspan="'+ (num+1) +'" name="list-5" class="cate_title" style="font-size:20px"><b>个体心理</b></td></tr>';
    html += '<tr class="list-5"><td class="cate_title" style="width:90px;text-align:right">心理状态</td>';
    for(var k in portrait){
        j += 1;
        html += '<td class="center" name="line'+ j +'">'+ portrait[k]['uname'] +'</td>';
    }
    html += '</tr>';
    j = 0;
    html += '<tr class="list-5"><td class="cate_title" style="width:90px;text-align:right">心理特征</td>';
    for(var k in portrait){
        j += 1;
        html += '<td class="center" name="line'+ j +'">'+ portrait[k]['uname'] +'</td>';
    }
    html += '</tr>';

    html += '</tbody>';
    $('#table_compare').append(html);
}


Compare();
var i = 0;
var div ;
var m = 0;
for(var key in portrait){
    i += 1;
    div = 'line'+ i;
    Search_weibo.Draw_cloud_keywords(portrait[key], div);
}
var x_data = activity[2];
var y_data = activity[0];
console.log(x_data);
console.log(y_data);
for(var key in y_data){
    m += 1;
    div = 'activity'+m;
    Search_weibo.Draw_line(x_data,y_data[key],div );

}
$(function () {
    $("#table_compare").fixedtableheader({ highlightrow: true, highlightclass: "", headerrowsize: 0});
});
 $('.btn-round').click(function(){
    console.log('ssss');
    $('[name='+ $(this).attr("name") +']').remove();
 });
 $("td[name^='list-']").click(function(){
    var name = $(this).attr('name');
    console.log(name);
    $('.'+ name).each(function(){
        if($(this).css('display') == 'table-row'){
            $(this).css('display','none');
        }
        else{
            $(this).css('display','table-row');
        }
    });
 });
</script>
{% endblock %}
