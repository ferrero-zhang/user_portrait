<html>
    <head>
        <meta charset="UTF-8" />       
    </head>
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Pragma" content="no-cache">
    <body>
    <h4 class="page-header" style='margin-top:-40px'>用户信息条件搜索</h4>
    <div>
        <form>
            <select class="form-control" onchange="setSubmitName(this)"style="float:left;width:12%" id="select_item" name="source">
                <option value="nick_name">昵称</option>
                <option value="rel_name">真实姓名</option>
                <option value="user_email">邮箱</option>
                <option value="uid" selected="selected">UID</option>
            </select>
                <span><input type="text" id='search'name=q1 style='float:left;width:20%' class="form-control" placeholder="Search for..."></span>
                <span class="input-group-btn">
                   <input class="btn btn-primary" name="submit" type='submit' id="submit" value=开始搜索>
                </span>
        </form>
        <div><a class="btn btn-primary" style='float:right' role="button" data-toggle="collapse" href="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
  高级搜索
  </a></div>
    </div>

    <div class="collapse" id="collapseExample">
      <div class="well">
            <form name=f id=f method="get">
                <div class="row">
                  <div class="col-lg-3">
                    <div class="input-group">
                    <span class="input-group-addon" id="sizing-addon1">UID</span>
                      <input type="text" class="form-control" name=q1 placeholder="Search for...">
                    </div><!-- /input-group -->
                  </div><!-- /.col-lg-6 -->
                  <div class="col-lg-3">
                    <div class="input-group">
                      <span class="input-group-addon" id="sizing-addon1">昵称</span>
                      <input type="text" class="form-control" name=q2 placeholder="Search for...">
                    </div><!-- /input-group -->
                  </div><!-- /.col6 -->
                  <div class="col-lg-3">
                    <div class="input-group">
                      <span class="input-group-addon" id="sizing-addon1">真实姓名</span>
                      <input type="text" class="form-control" name=q3 placeholder="Search for...">
                    </div><!-- /input-group -->
                  </div><!-- /.col-lg-6 -->
                  <span class="input-group-btn">
                     <input style='margin-left:20px' class="btn btn-primary" name="submit" type='submit' id="submit" value=开始搜索>
                  </span>
                </div><!-- /.row -->
                <div class="row" style='margin-top:10px'>
                  <div class="col-lg-3">
                    <div class="input-group">
                      <span class="input-group-addon" id="sizing-addon1">注册地</span>
                      <input type="text" class="form-control" name=q12 placeholder="Search for...">
                    </div><!-- /input-group -->
                  </div><!-- /.col-lg-6 -->
                  <div class="col-lg-3">
                    <div class="input-group">
                      <span class="input-group-addon" name=q4 id="sizing-addon1">来源</span>
                      <input type="text" class="form-control" placeholder="Search for...">
                    </div><!-- /input-group -->
                  </div><!-- /.col-lg-6 -->
                  <div class="col-lg-3">
                    <div class="input-group">
                      <span class="input-group-addon" id="sizing-addon1">邮箱</span>
                      <input type="text" class="form-control" name=q7 placeholder="Search for...">
                    </div><!-- /input-group -->
                  </div><!-- /.col-lg-6 -->
                </div><!-- /.row -->
                <div class="row" style='margin-top:10px'>
                  <div class="col-lg-3">
                    <div class="input-group">
                      <span class="input-group-addon" name=q5 id="sizing-addon1">微博数大于</span>
                      <input type="text" class="form-control" placeholder="Search for...">
                    </div><!-- /input-group -->
                  </div><!-- /.col-lg-6 -->
                  <div class="col-lg-3">
                    <div class="input-group">
                      <span class="input-group-addon" name=q6 id="sizing-addon1">微博数小于</span>
                      <input type="text" class="form-control" placeholder="Search for...">
                    </div><!-- /input-group -->
                  </div><!-- /.col-lg-6 -->
                  <div class="col-lg-3">
                    <div class="input-group">
                    <span class="input-group-addon" id="sizing-addon1">降序排序</span>
                    <span><select class="form-control" style="width:140px" name="order">
                      <option value=0 selected> 微博数</option>
                      <option value=1> 粉丝数</option>
                      <option value=2> 好友数</option>
                    </select></span>
                  </div>
                  </div>
                </div><!-- /.row -->
                <div class="row" style='margin-top:10px'>
                  <div class="col-lg-3">
                    <div class="input-group">
                      <span class="input-group-addon" name=q8 id="sizing-addon1">粉丝数大于</span>
                      <input type="text" class="form-control" placeholder="Search for...">
                    </div><!-- /input-group -->
                  </div><!-- /.col-lg-6 -->
                  <div class="col-lg-3">
                    <div class="input-group">
                      <span class="input-group-addon" name=q9 id="sizing-addon1">粉丝数小于</span>
                      <input type="text" class="form-control" placeholder="Search for...">
                    </div><!-- /input-group -->
                  </div><!-- /.col-lg-6 -->
                </div><!-- /.row -->
                                <div class="row" style='margin-top:10px'>
                  <div class="col-lg-3">
                    <div class="input-group">
                      <span class="input-group-addon" name=q10 id="sizing-addon1">关注数大于</span>
                      <input type="text" class="form-control" placeholder="Search for...">
                    </div><!-- /input-group -->
                  </div><!-- /.col-lg-6 -->
                  <div class="col-lg-3">
                    <div class="input-group">
                      <span class="input-group-addon" name=q11 id="sizing-addon1">关注数小于</span>
                      <input type="text" class="form-control" placeholder="Search for...">
                    </div><!-- /input-group -->
                  </div><!-- /.col-lg-6 -->
                </div><!-- /.row -->
            </form>
      </div>
    </div>
        <h4 class="page-header"style="margin-top:10px">检索信息</h4>
           
        <div style="float:left;width:50%"class="list-group-item list-group-item-success">耗时：{{ source.took }}ms</div>
        <div style="float:right;width:50%"class="list-group-item list-group-item-success">命中：{{ source.hits.total }}条</div>
        <h4 class="page-header"style="margin-top:80px">用户信息列表</h4>
        <div class="table-responsive">
              <table class="table table-striped table-bordered bootstrap-datatable datatable responsive">
                <thead>
                    <tr>
                        <th>uid</th>
                        <th>昵称</th>
                        <th>性别</th>
                        <th>注册地</th>
                        <th>关注数</th>
                        <th>粉丝数</th>
                        <th>微博数</th>
                        <th>导出</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in source.hits.hits %}
                <tr>
                    <td class="center"><a href="{{ url_for('profile.detail', id=item._id) }}">{{ item._id }}</td>
                    <td class="center">{{ item._source.nick_name }}</td>
                    <td class="center">{{ gender(item._source.sex) }}</td>
                    <td class="center">{{ item._source.user_location }}</td>
                    <td class="center">{{ item._source.friendsnum }}</td>
                    <td class="center">{{ item._source.fansnum }}</td>
                    <td class="center">{{ item._source.statusnum }}</td>
                    <td class="center"><a href="#"  onclick='get_file({{ item._id }})' download="test.json">导出</a></td>
                </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        </div>
    </body>
</html>
<script>
  function get_file(id, add){
    $.ajax({
            url: 'http://219.224.135.93:9001/profile/download/?id='+id,
            type: "GET",
            GE: "json",
            async: false,
            success: function(data){
              console.log(data);
              window.location.href = 'http://219.224.135.93:9001/static/test.csv';
            }
        })
  }
</script>